<?php

function computed_field_field_volume_percentage_compute(&$entity_field, $entity_type, $entity, $field, $instance, $langcode, $items) {
  $entity_field[0]['value'] = 0;
  if (is_numeric($entity->volume) && is_numeric($entity->avg_daily_volume) || $entity->volume != 0 || $entity->avg_daily_volume != 0) {
    $entity_field[0]['value'] = round($entity->volume / $entity->avg_daily_volume, 10);
  }
}

function nufios_stockinfo_save(&$stock) {
  if (strpos($stock['name'], "Corporati") !== false) {
    substr_replace($stock['name'], "Corporation", " ", 9);
  }
}

/**
 * Implement hook_rules_action_info().
 */
function nufios_rules_action_info() {
  return array(
    'nufios_rules_action_pull_stock_property' => array(
      'label' => t('Pull Stock Property Value'),
      'group' => t('Nufios'),
      'provides' => array(
        'stock_property' => array(
          'type' => 'text',
          'label' => t('Stock Property Type'),
        ),
        'stock_property_value' => array(
          'type' => 'number',
          'label' => t('Stock Property Value'),
        ),
      ),
    ),
  );
}

function nufios_rules_action_pull_stock_property() {
  $stockinfo_info = entity_get_all_property_info("stockinfo");
  $stockinfo_keys = array_key($stockinfo_info);
  $key = '';
  $while_array = array("sid", "symbol", "name", "url", "updated");
  do {
    $key = array_rand($stockinfo_keys, 1);
  } while (in_array($key, $while_array));
  watchdog("key", "<pre>" . print_r($key, true) . "</pre>");
}
